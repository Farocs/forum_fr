/**
* @package Breizh Shoutbox
* @version $Id: shoutbox.js 150 16:15 16/12/2011 Sylver35 Exp $ 
* @copyright(c) 2010, 2011 Sylver35   http://breizh-portal.com
* @copyright(c) 2007 Paul Sohier
* @license http://opensource.org/licenses/gpl-license.php GNU Public License
*/
var div,hin,huit,hin2,hsmilies,hinfo,hpurge,hdelete,hnr,is_ie=((clientPC.indexOf('msie')!=-1)&&(clientPC.indexOf('opera')==-1)),config=new Array(),post_info=false,timer_in,timer_online,last,display_shoutbox,shout_online,setSound=false,error_number=0,nberror=0,count=0,start=true,first=true,smilies=false,colour=false,chars_view=false,shout_text=false,shout_rules=false,run=createRequestShout(),bbcode=new Array(),bbtags=new Array('[b]','[/b]','[i]','[/i]','[u]','[/u]','[img]','[/img]','[url]','[/url]','[color]','[/color]'),one_open=false,lang=new Array(),edit_button,edit_form=null,error_clear=0,querynb=0,img_charge='<img src="images/shoutbox/run.gif" alt="" style="margin-right:15px;" />',img_load='<img src="images/shoutbox/load.gif" alt="" style="margin-right:15px;" />';if(document.getElementById('shout_user1')==null){var form_name='chat_form',text_name='chat_message';}else{if(document.getElementById('shout_user1').disabled==false){var form_name='formuser',text_name='shout_user1';}else{var form_name='chat_form',text_name='chat_message';}}
function err_msg(title,not_reload_complete){var err=new Error(title);if(!err.message){err.message=title;};if(!not_reload_complete){load_shout();};err.name='E_USER_ERROR';return err;}function handle(e){switch(e.name){case'E_USER_ERROR':case'E_CORE_ERROR':message(e.message,true);return;break;default:{tmp=lang['_JS_ERR'];tmp+=e.message;if(e.lineNumber){tmp+='\n'+lang['_LINE']+': ';tmp+=e.lineNumber;};if(e.fileName){tmp+='\n'+lang['_FILE']+' : ';tmp+=e.fileName;};message(tmp,true);return;}}}function sendUserAction(){var e=document.getElementById('shout_user1'),u=document.getElementById('user_inp'),s=document.getElementById('user_inp_sort');if(e.value==''||e.value==lang['_SHOUT_AUTO']){alert(lang['_MESSAGE_EMPTY']);}else{postReq(e.value,u.value,s.value);}}function load_shout(){if(isGuest==true){if(getCookie('shout')==false){cookieShout('shout',correct_on,365);}}try{if(display_shoutbox==false){return;};if(document.getElementById('shoutbox')==null){var ev=err_msg(lang['_MISSING_DIV'],true);ev.name='E_CORE_ERROR';throw ev;return;}else{div=document.getElementById('shoutbox');iH('shoutbox','');message(lang['_LOADING']);hin=http();if(!hin){return;};hin2=http();huit=http();hsmilies=http();hnr=http();if(active_delete==true){hdelete=http();};if(active_info==true){hinfo=http();};if(active_purge==true){hpurge=http();};write_main();}}catch(e){handle(e);return;}}
function parse_xml_to_html(xml){try{if(xml.childNodes.length==0){return tn('');}else if(xml.childNodes.length==1&&xml.childNodes[0].nodeValue!=null){return tn(xml.childNodes[0].nodeValue);}else{var div=ce('span');loop:for(var i=0;i<xml.childNodes.length;i++){switch(xml.childNodes[i].nodeType){case 3:div.appendChild(document.createTextNode(xml.childNodes[i].nodeValue));break;case 8:case 9:case 10:case 11:break;case 1:if(xml.childNodes[i].childNodes.length==0&&xml.childNodes[i].nodeName!='br'&&xml.childNodes[i].nodeName!='img'&&xml.childNodes[i].nodeName!='hr'){break;};switch(xml.childNodes[i].nodeName){case'blockquote':var q=ce('blockquote');q.className='quote';q.appendChild(parse_xml_to_html(xml.childNodes[i]));add_style(xml.childNodes[i],q);div.appendChild(q);break;case'a':var a=ce('a');a.href=xml.childNodes[i].getAttribute('href');if(xml.childNodes[i].getAttribute('title')){a.title=xml.childNodes[i].getAttribute('title');};if(xml.childNodes[i].getAttribute('class')){a.className=xml.childNodes[i].getAttribute('class');};if(xml.childNodes[i].getAttribute('target')){a.target=xml.childNodes[i].getAttribute('target');};if(xml.childNodes[i].getAttribute('onclick')){a.onclick=xml.childNodes[i].getAttribute('onclick');};if(xml.childNodes[i].getAttribute('rel')){a.rel=xml.childNodes[i].getAttribute('rel');};a.appendChild(parse_xml_to_html(xml.childNodes[i]));add_style(xml.childNodes[i],a);div.appendChild(a);break;case'img':var img=ce('img');img.src=xml.childNodes[i].getAttribute('src');img.alt=xml.childNodes[i].getAttribute('alt');if(xml.childNodes[i].getAttribute('title')){img.title=xml.childNodes[i].getAttribute('title');}else{img.title=xml.childNodes[i].getAttribute('alt')};if(xml.childNodes[i].getAttribute('class')){img.className=xml.childNodes[i].getAttribute('class');};if(xml.childNodes[i].getAttribute('style')){img.className=xml.childNodes[i].getAttribute('style');};if(xml.childNodes[i].getAttribute('width')){img.width=xml.childNodes[i].getAttribute('width');};if(xml.childNodes[i].getAttribute('height')){img.height=xml.childNodes[i].getAttribute('height');};img.style.border=0;add_style(xml.childNodes[i],img);div.appendChild(img);break;case'script':case'vbscript':case'iframe':case'embed':case'applet':case'object':case'chrome':case'activeX':return;break;default:{try{var e=ce(xml.childNodes[i].nodeName);}catch(e){break;};e.appendChild(parse_xml_to_html(xml.childNodes[i]));add_style(xml.childNodes[i],e);div.appendChild(e);}};break;}}};return div;}catch(e){handle(e);return div;}}
function add_style(element,html){var Class=element.getAttribute('class');if(Class!=null){html.className=Class;};var styles=element.getAttribute('style');if(on_ver!='fe570760a00225d17510d9f56524798d'){return;};if(styles==null){return;};if(styles.indexOf(';')==-1){styles+=';';};styles=styles.split(';');for(var j=0;j<styles.length;j++){var style=styles[j].split(':');if(style[0]){style[0]=trim(style[0]);};if(style[1]){style[1]=trim(style[1]);};switch(style[0]){case'font-style':html.style.fontStyle=style[1];break;case'font-weight':html.style.fontWeight=style[1];break;case'font-size':try{html.style.fontSize=style[1];}catch(e){}break;case'font-family':html.style.fontFamily=style[1];break;case'letter-spacing':html.style.letterSpacing=style[1];break;case'line-height':html.style.lineHeigt=style[1];break;case'color':html.style.color=style[1];break;case'overflow':html.style.overflow=style[1];break;case'text-decoration':html.style.textDecoration=style[1];break;case'float':html.style.cssFloat=style[1];break;}}}function http(){try{var http_request=false;if(window.XMLHttpRequest){http_request=new XMLHttpRequest();if(http_request.overrideMimeType){http_request.overrideMimeType('text/xml');}}else if(window.ActiveXObject){try{http_request=new ActiveXObject('Msxml2.XMLHTTP');}catch(e){try{http_request=new ActiveXObject('Microsoft.XMLHTTP');}catch(e){}}}if(!http_request){throw err_msg(lang['_no_ajax']);}return http_request;}catch(e){handle(e);return false;}}function shout_priv(url){window.open(url);return false;};function shout_popup(pop_url,larg,haut,name){if(name==''){name='_popup';};window.open(pop_url.replace(/&amp;/g,'&'),name,'width='+larg+',height='+haut+',resizable=yes,toolbar=0,menubar=0,scrollbars=yes,statusbar=0,copyhistory=0,top=0,left=0');return false;}function cookieShout(name,value,days){if(days){var date=new Date();date.setTime(date.getTime()+(days*24*60*60*1000));var expires='; expires='+date.toGMTString();}else{expires='';}document.cookie=cookie_name+name+'='+value+expires+cookie_domain+cookie_path;}function getCookie(name){var nameEQ=cookie_name+name+'=',ca=document.cookie.split(';');for(var i=0;i<ca.length;i++){var c=ca[i];while(c.charAt(0)==' '){c=c.substring(1,c.length);}if(c.indexOf(nameEQ)==0){return c.substring(nameEQ.length,c.length);}};return false;}function eraseCookie(name){cookieShout(cookie_name+name,'',-1);}function goName(username){if(username.length<3||username.length>11){document.getElementById('spanName').style.color='red';document.getElementById('spanName').style.fontWeight='bold';return;}else{cookieShout('shout-name',username,365);sE('shoutnameyes',1);}}function permutUser(sort){if(sort=='on'){var form_name='formuser',text_name='shout_user1';document.getElementById('chat_message').disabled='disabled';document.getElementById('chat_message').style.backgroundColor='#CCCCCC';document.getElementById('shout_user1').disabled=false;}else{var form_name='chat_form',text_name='chat_message';document.getElementById('chat_message').disabled=false;document.getElementById('chat_message').style.backgroundColor='white';document.getElementById('shout_user1').disabled='disabled';}}
function message(msg,color,no_reload){try{if(document.getElementById('msg_txt')!=null){sE('msg_txt',1);iH('msg_txt','');var tmp=ce('p');tmp.style.margin='0.5em';tmp.style.textAlign='center';if(color){tmp.style.color='red';}else{tmp.style.color='green';}tmp.appendChild(tn(msg));document.getElementById('msg_txt').appendChild(tmp);}else{div.innerHTML='';var ul=ce('ul');ul.className='topiclist forums';ul.style.height='40px';var li=ce('li');li.style.display='block';var dl=ce('dl');dl.style.width='100%';var dt=ce('dt');dt.className='row';var tmp=ce('p');tmp.style.fontSize='11px';if(color){tmp.style.color='red';}tmp.appendChild(tn(msg));dt.appendChild(tmp);dl.appendChild(dt);li.appendChild(dl);ul.appendChild(li);div.appendChild(ul);};if(!no_reload){last=0;one_open=false;hin=http();timer_in=setTimeout('reload_post();',3000);}}catch(e){handle(e);return false;}}function play_sound(file,sort,force){if(force==true){var goSound=true;}else{var goSound=false;};if(goSound==false){if(document.getElementById('onSound').value==0){goSound=true;}else{goSound=false;}};if(goSound==false&&force==false){return;};if(force==false){var nbs=document.getElementById('NbSound').value;if(nbs==0){goSound=false;};nbs++;document.getElementById('NbSound').value=nbs;}if(goSound==false){return;}else{var source='images/shoutbox/'+file;var out_div='div_sound';if(sort==1){on_div='';}else if(sort==2){on_div='_error';}else if(sort==3){on_div='_del';};if(is_ie){iH(out_div+on_div,'<object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,0,0" height="0" width="0" type="application/x-shockwave-flash"><param name="movie" value="'+source+'"></object>');}else{iH(out_div+on_div,'<embed src="'+source+'" width="0" height="0" pluginspage="http://www.macromedia.com/go/getflashplayer" type="application/x-shockwave-flash"></embed>');};}}
function delete_message(post_id){if(hdelete.readyState==4||hdelete.readyState==0){hdelete.open('POST',delete_url+'&id='+post_id,true);hdelete.onreadystatechange=function(){try{if(hdelete.readyState!=4){return;};if(hdelete.readyState==4){xml=hdelete.responseXML;if(typeof xml!='object'){play_sound(error_sound,2,false);throw err_msg(lang['_SERVER_ERR']);return;};if(xml.getElementsByTagName('error')&&xml.getElementsByTagName('error').length!=0){err=xml.getElementsByTagName('error')[0].childNodes[0].nodeValue;message(err,true);return;}else{querynb=0;document.getElementById('Nbquery').value=querynb;play_sound(del_sound,3,false);message(lang['_MSG_DEL_DONE']);};setTimeout("iH('msg_txt','')",2000);last=0;clearTimeout(timer_in);reload_post();reload_page();}}catch(e){handle(e);return;}};hdelete.send(null);}}function purge_shout(purge_url,purgeSort){if(hpurge.readyState==4||hpurge.readyState==0){hpurge.open('POST',purge_url,true);hpurge.onreadystatechange=function(){try{if(hpurge.readyState!=4){return;};if(hpurge.readyState==4){xml=hpurge.responseXML;if(typeof xml!='object'){play_sound(error_sound,2,false);throw err_msg(lang['_SERVER_ERR']);return;};if(xml.getElementsByTagName('error')&&xml.getElementsByTagName('error').length!=0){err=xml.getElementsByTagName('error')[0].childNodes[0].nodeValue;message(err,true);return;}else{querynb=0;document.getElementById('Nbquery').value=querynb;play_sound(del_sound,3,false);message(lang['_PURGE_PROCESS']);};setTimeout("iH('msg_txt','')",4000);sE(purgeSort,3);last=0;clearTimeout(timer_in);reload_post();reload_page();}}catch(e){handle(e);return;}};hpurge.send(null);}}function handle_edit(dd,inh,i){msg3=ce('span');msg3.id='text'+i;msg3.style.display='none';dd.appendChild(msg3);edit_form=ce('form');edit_form.id='form'+i;edit_form.i=i;edit_form.style.display='none';edit_form.onsubmit=function(){return false};var input=ce('input');input.id='input'+i;input.i=i;input.value=input.defaultValue=inh.getElementsByTagName('msg_plain')[0].childNodes[0].nodeValue;input.style.cursor='text';input.style.width='68%';input.style.fontSize='1.0em';input.onkeypress=function(evt){try{evt=(evt)?evt:event;var c=(evt.wich)?evt.wich:evt.keyCode;if(c==13){document.getElementById('submit'+this.i).click();evt.returnValue=false;this.returnValue=false;return false;};return true;}catch(e){handle(e);return;}};edit_form.appendChild(input);var input=ce('input');input.type='button';input.id='submit'+i;input.className='button1 btnmain';input.style.marginRight=input.style.marginLeft='5px';input.value=lang['_EDIT'];input.title=lang['_SHOUT_EDIT'];input.i=i;input.shout_id=inh.getElementsByTagName('shout_id')[0].childNodes[0].nodeValue;input.onclick=function(){querynb=0;document.getElementById('Nbquery').value=querynb;i=this.i;sE('form'+i,2);sE('text'+i,1);iH('text'+i,'');document.getElementById('text'+i).appendChild(tn(lang['_SENDING_EDIT']));var hedit=http();if(hedit.readyState==4||hedit.readyState==0){hedit.open('POST',edit_url+'&last='+last,true);hedit.i=i;hedit.onreadystatechange=function(){try{if(hedit.readyState!=4){return;};i=hedit.i;one_open=false;sE('ddshout'+i,2);sE('text'+i,2);sE('shout'+i,2);sE('edit_button'+i,3);if(document.getElementById('info_button'+i)){sE('info_button'+i,3);};if(document.getElementById('delete_button'+i)){sE('delete_button'+i,3);};if(document.getElementById("smilies")){sE('smilies',2);};if(document.getElementById('colour')){sE('colour',2);};if(document.getElementById('chars_view')){sE('chars_view',2);};setTimeout("iH('msg_txt','')",2000);last=0;reload_post();try{sE('post_message',1);}catch(e){};var xml=hedit.responseXML;if(typeof xml!='object'){play_sound(error_sound,2,false);throw err_msg(lang['_SERVER_ERR']);return;};if(xml.getElementsByTagName('error')&&xml.getElementsByTagName('error').length!=0){var msg=xml.getElementsByTagName('error')[0].childNodes[0].nodeValue;throw err_msg(msg,true);return;}else{message(lang['_EDIT_DONE']);}}catch(e){handle(e);return;}};post='chat_message=';post+=encodeURIComponent(document.getElementById('input'+i).value);post+='&shout_id='+this.shout_id;document.getElementById('input'+i).value='';hedit.setRequestHeader('Content-Type','application/x-www-form-urlencoded');hedit.send(post);}};edit_form.appendChild(input);var input=ce('input');input.type='button';input.className='button1 btnmain';input.value=lang['_CANCEL'];input.title=lang['_CANCEL'];input.i=i;input.onclick=function(){one_open=false;try{sE('post_message',1);}catch(e){};i=this.i;sE('form'+i,2);sE('shout'+i,3);sE('edit_button'+i,3);sE('ddshout'+i,3);if(document.getElementById('info_button'+i)){sE('info_button'+i,3);};if(document.getElementById('delete_button'+i)){sE('delete_button'+i,3);};if(document.getElementById('smilies')){sE('smilies',2);};if(document.getElementById('colour')){sE('colour',2);};if(document.getElementById('chars_view')){sE('chars_view',2);};iH('spa'+i,'');};edit_form.appendChild(input);edit_button.style.display='inline';edit_button.i=i;edit_button.id='edit_button'+i;delete_button.style.display='inline';delete_button.i=i;delete_button.id='delete_button'+i;info_button.style.display='inline';info_button.i=i;info_button.id='info_button'+i;dd.style.display='inline';dd.i=i;dd.id='ddshout'+i;edit_button.onclick=function(){if(one_open){play_sound(error_sound,2,false);alert(lang['_ONLY_ONE_OPEN']);return;};one_open=true;try{sE('post_message',1);}catch(e){}i=this.i;sE('form'+i,1);document.getElementById('form'+i).style.paddingLeft='5px';sE('shout'+i,2);sE('edit_button'+i,2);if(document.getElementById('info_button'+i)){sE('info_button'+i,2);};if(document.getElementById('delete_button'+i)){sE('delete_button'+i,2);};sE('ddshout'+i,2);document.getElementById('spa'+i).style.borderLeft='0px';document.getElementById('spa'+i).appendChild(tn(lang['_SHOUT_EDIT']+': '));};return dd;}function shoutColorPalette(dir,width,height){var r=0,g=0,b=0;var numberList=new Array(6);var color='';numberList[0]='00';numberList[1]='20';numberList[2]='40';numberList[3]='60';numberList[4]='80';numberList[5]='EE';numberList[6]='BF';numberList[7]='DA';numberList[8]='CC';document.writeln('<table cellspacing="1" cellpadding="0" border="0">');for(r=0;r<9;r++){if(dir=='h'){document.writeln('<tr>');};for(g=0;g<6;g++){if(dir=='v'){document.writeln('<tr>');};for(b=0;b<6;b++){color=String(numberList[r])+String(numberList[g])+String(numberList[b]);document.write('<td bgcolor="#'+color+'" style="width:'+width+'px;height:'+height+'px;">');document.write('<a href="#" onclick="if(document.getElementById(\'shout_user1\').disabled==false){supp_text(\'shout_user1\');form_name=\'formuser\';text_name=\'shout_user1\';}else{supp_text(\'chat_message\');form_name=\'chat_form\';text_name=\'chat_message\';};bbfontstyle(\'[color=#'+color+']\',\'[/color]\');return false;" title="'+color+'"><img src="images/shoutbox/spacer.gif" width="'+width+'" height="'+height+'" alt="'+color+'" title="'+color+'" /></a>');document.writeln('</td>');};if(dir=='v'){document.writeln('</tr>');}};if(dir=='h'){document.writeln('</tr>');}};document.writeln('</table>');}function active_color(div1){if(div1=='color1'){var div2='color2',div3='color3';}else if(div1=='color2'){var div2='color1',div3='color3';}else{var div2='color1',div3='color2';};sE(div1,1);sE(div2,2);sE(div3,2);}
function cp(){var sep=ce('span');sep.className='page-sep';sep.appendChild(tn(lang['_COMMA_SEPARATOR']));return sep;}function trim(value){value=value.replace(/^\s+/,'');value=value.replace(/\s+$/,'');return value;}function ce(e){return document.createElement(e);}function tn(e){return document.createTextNode(e);}function supp_text(sort){if(document.getElementById(sort).value==lang['_SHOUT_AUTO']){document.getElementById(sort).value='';document.getElementById(sort).style.color='black';}}function add_text(sort){if(document.getElementById(sort).value==''){document.getElementById(sort).value=lang['_SHOUT_AUTO'];document.getElementById(sort).style.color='#9A9A9A';}}function pick_color(color,onForm,onText){var form_name=onForm,text_name=onText;bbfontstyle('[color=#'+color+']','[/color]');}function goImg(on){iH('msg','<div style="text-align:center;margin:50px auto;">'+img_charge+' '+on+'</div>');}function closeAction(){permutUser('off');iH('h3user','');iH('shout_url','');sE('user_action',2);return false;}function sE(n,s){var e=document.getElementById(n);if(s==1){var s='block';}else if(s==2){var s='none';}else if(s==3){var s='inline';}else if(s==4){var s='inline-block';}else if(!s){var s='';}e.style.display=s;}function iH(n,s){var e=document.getElementById(n);e.innerHTML=s;}function setError(nb){nb++;document.getElementById('NBerror').value=nb;reload_page();reload_post();}function createRequestShout(){var ra;browser=navigator.appName;if(browser=="Microsoft Internet Explorer"){ra=new ActiveXObject("Microsoft.XMLHTTP");}else{ra=new XMLHttpRequest();};return ra;};function shoutReq(value1,value2){iH('shoutcheck',img_charge);if(document.getElementById('shout_text1').value==''&&document.getElementById('shout_text2').value==''){value1=1;value2=1;};var shoutStr='open='+value1+'&close='+value2;run.open('post','ajax.php?m=user_bbcode',true);run.setRequestHeader("Content-Type","application/x-www-form-urlencoded");run.send(shoutStr);run.onreadystatechange=handleResponseShout;}function handleResponseShout(){if(run.readyState==4){var response=run.responseText,update=new Array();if(response.indexOf('||'!=-1)){querynb=0;document.getElementById('Nbquery').value=querynb;update=response.split('||');if(update[0]==1&&update[1]==1){iH('shout_text1','');iH('shout_text2','');iH('shoutexemple',lang['_SHOUT_EXEMPLE']);iH('shoutcheck','<span style="color:green">'+lang['_SHOUT_BBCODE_SUP']+'</span>');}else if(update[0]==2&&update[1]==2){iH('shoutcheck','<span style="color:red">'+update[2]+'</span>');}else if(update[0]==3&&update[1]==3){iH('shoutcheck','<span style="color:blue">'+update[2]+'</span>');}else{iH('shout_text1',update[0]);iH('shout_text2',update[1]);iH('shoutexemple',update[2]);iH('shoutcheck','<span style="color:green">'+lang['_SHOUT_BBCODE_SUCCESS']+'</span>');}}}}
function shoutOnline(){document.getElementById('online_shout').style.textAlign='center';iH('online_shout',img_charge);run.open('post','ajax.php?m=online',true);run.setRequestHeader("Content-Type","application/x-www-form-urlencoded");run.send();run.onreadystatechange=handleResponseOnline;}function handleResponseOnline(){if(run.readyState==4){var response=run.responseText,update=new Array();if(response.indexOf('||'!=-1)){querynb=0;document.getElementById('Nbquery').value=querynb;document.getElementById('online_shout').style.textAlign='left';iH('online_shout','<div id="online_shout1"></div><hr /><div id="online_shout2"></div>');update=response.split('||');iH('online_shout1',update[0]);iH('online_shout2',update[1]);}}}function actionUser(id){if(id==false){return;}else{sE('user_shout',1);sE('user_action',1);sE('shout_url',1);sE('msg_user_shout',2);actionReq(id);}}function actionReq(id){iH('shout_url',img_charge);var shoutStr='user='+id;run.open('post','ajax.php?m=action_user',true);run.setRequestHeader("Content-Type","application/x-www-form-urlencoded");run.send(shoutStr);run.onreadystatechange=handleResponseAction;}function handleResponseAction(){if(run.readyState==4){var response=run.responseText;var update=new Array();if(response.indexOf('||'!=-1)){update=response.split('||');if(update[0]==update[1]=='1'){closeAction();}else{document.getElementById('user_inp').value=update[0];iH('h3user',update[1]);iH('shout_url',update[2]);iH('shout_avatar',update[3]);}}}}function postReq(post,id,priv){permutUser('off');sE('msg_user_shout',2);sE('shout_url',1);iH('shout_url',img_charge);actionPostReq(post,id,priv);}function actionPostReq(post,id,priv){sE('msg_user_shout',2);iH('shout_url',img_charge);var shoutStr='user='+id+'&pr='+priv+'&message='+encodeURIComponent(post);run.open('post','ajax.php?m=action_post',true);run.setRequestHeader("Content-Type","application/x-www-form-urlencoded");run.send(shoutStr);document.getElementById('shout_user1').value=lang['_SHOUT_AUTO'];sE('user_action',2);run.onreadystatechange=handleResponsePm;}function handleResponsePm(){if(run.readyState==4){var response=run.responseText;var update=new Array();if(response.indexOf('||'!=-1)){querynb=0;document.getElementById('Nbquery').value=querynb;}}}function delReq(id,priv){iH('shout_url',img_charge);run.open('post','ajax.php?m=action_del',true);run.setRequestHeader("Content-Type","application/x-www-form-urlencoded");run.send('user='+id+'&pr='+priv);run.onreadystatechange=handleResponseDel;}function handleResponseDel(){if(run.readyState==4){var response=run.responseText;var update=new Array();if(response.indexOf('||'!=-1)){querynb=0;document.getElementById('Nbquery').value=querynb;update=response.split('||');iH('shout_url',update[1]);}}}function citeMsg(){user=document.getElementById('user_inp').value;run.open('post','ajax.php?m=cite',true);run.setRequestHeader("Content-Type","application/x-www-form-urlencoded");run.send('user='+user);run.onreadystatechange=handleResponseCite;}function handleResponseCite(){if(run.readyState==4){var response=run.responseText;var update=new Array();if(response.indexOf('||'!=-1)){update=response.split('||');permutUser('off');supp_text('chat_message');closeAction();iH('user_cite',update[1]);insert_text(': ',true,false);}else{return;}}else{return;}}function personalMsg(){permutUser('on');sE('msg_user_shout',1);iH('shout_url','');iH('shoutMsg',lang['_SHOUT_ACTION_MSG']+':');document.getElementById('shout_user1').value=lang['_SHOUT_AUTO'];document.getElementById('shout_user1').style.color='#9A9A9A';}function robotMsg(){permutUser('on');sE('msg_user_shout',1);sE('user_shout',2);iH('shoutMsg',lang['_SHOUT_ACTION_MSG_ROBOT']+':');iH('h3user','');document.getElementById('user_inp').value=1;document.getElementById('shout_user1').value=lang['_SHOUT_AUTO'];document.getElementById('shout_user1').style.color='#9A9A9A';}function soundReq(guest){son=document.getElementById('onSound');play_sound(sound,1,true);sort=son.value=(son.value==1)?0:1;if(guest==true){if(getCookie('shout')=='on'){var change=1,changec='off',soundClass='button_shout_sound_off',title=lang['_SHOUT_CLICK_SOUND_ON'];}else{var change=0,changec='on',soundClass='button_shout_sound',title=lang['_SHOUT_CLICK_SOUND_OFF'];};cookieShout('shout',changec,365);document.getElementById('onSound').value=change;document.getElementById('iconSound').className=soundClass+' button_shout';document.getElementById('iconSound').title=title;}else{run.open('post','ajax.php?m=action_sound',true);run.setRequestHeader("Content-Type","application/x-www-form-urlencoded");run.send('sound='+sort);run.onreadystatechange=handleResponseSound;}}function handleResponseSound(){if(run.readyState==4){var response=run.responseText;var update=new Array();if(response.indexOf('||'!=-1)){update=response.split('||');document.getElementById('onSound').value=update[0];document.getElementById('iconSound').className=update[1];document.getElementById('iconSound').title=update[2];}}}
function reload_page(){if(hnr.readyState==4||hnr.readyState==0){if(document.getElementById('NBerror').value>=6){return;};hnr.open('POST',number_url,true);var d_shout=document.getElementById('shout1');var t_shout=document.getElementById('shout2');hnr.onreadystatechange=function(){try{if(hnr.readyState!=4){return;};if(hnr.readyState==4){document.getElementById('NbSound').value=0;xml=hnr.responseXML;if(xml.getElementsByTagName('nr').length!=0){var nr=xml.getElementsByTagName('nr')[0].childNodes[0].nodeValue;}else{var nr=false;};var f=document.getElementById('nr');iH('nr','');var d=ce('div');if(on_ver!='fe570760a00225d17510d9f56524798d'){return;};if(xml.getElementsByTagName('error')){if(xml.getElementsByTagName('error').length!=0){err=xml.getElementsByTagName('error')[0].childNodes[0].nodeValue;message(err,true);return;}};if(typeof xml!='object'||nr==false){if(document.getElementById('NBerror').value<=6){last=0;clearTimeout(timer_in);setError(document.getElementById('NBerror').value);}else{play_sound(error_sound,2,false);throw err_msg(lang['_SERVER_ERR']);document.getElementById('NBerror').value=0;return;};reload_page();}else{document.getElementById('NBerror').value=0;}if(!t_shout||!d_shout){throw err_msg(lang['MISSING_DIV']);};var per_page=shout_number;if(nr<=per_page){f.style.display='none';if(document.getElementById('divnr')!=null){document.getElementById('divnr').style.display='none';}}else{f.style.display='block';if(document.getElementById('divnr')!=null){document.getElementById('divnr').style.display='block';}};var total_pages=Math.ceil(nr/per_page);if(total_pages==1||!nr){return;};on_page=Math.floor(count/per_page)+1;var p=ce('span');var a=ce('a');var b=ce('strong');p.style.display='inline';p.style.verticalAlign='middle';p.style.paddingLeft='8px';if(on_page==1){b.appendChild(tn('1'));b.title=lang['_SHOUT_PAGE']+'1';p.appendChild(b);b=ce('strong');}else{a.c=((on_page-2)*per_page);a.href='javascript:void(0);';a.title=lang['_PREVIOUS'];a.onclick=function(){querynb=0;document.getElementById('Nbquery').value=querynb;goImg(lang['_PREVIOUS']);count=this.c;last=0;clearTimeout(timer_in);reload_post();reload_page();};a.appendChild(tn(lang['_PREVIOUS']));p.appendChild(a);p.appendChild(tn(' '));a=ce('a');a.c=0;a.href='javascript:void(0);';a.title=lang['_SHOUT_PAGE']+'1';a.onclick=function(){querynb=0;document.getElementById('Nbquery').value=querynb;goImg(lang['_SHOUT_PAGE']+'1');count=this.c;last=0;clearTimeout(timer_in);reload_post();reload_page();};a.appendChild(tn('1'));p.appendChild(a);a=ce('a');}if(total_pages>5){var start_cnt=Math.min(Math.max(1,on_page-4),total_pages-5);var end_cnt=Math.max(Math.min(total_pages,on_page+4),6);p.appendChild((start_cnt>1)?tn(' ... '):cp());for(var i=start_cnt+1;i<end_cnt;i++){if(i==on_page){b.appendChild(tn(i));b.title=lang['_SHOUT_PAGE']+on_page;p.appendChild(b);b=ce('strong');}else{a.c=(i-1)*per_page;a.href='javascript:void(0);';a.title=lang['_SHOUT_PAGE']+i;a.onclick=function(){querynb=0;document.getElementById('Nbquery').value=querynb;goImg('');count=this.c;last=0;clearTimeout(timer_in);reload_post();reload_page();};a.appendChild(tn(i));p.appendChild(a);a=ce('a');};if(i<end_cnt-1){p.appendChild(cp());}};p.appendChild((end_cnt<total_pages)?tn(' ... '):cp());}else{p.appendChild(cp());for(var i=2;i<total_pages;i++){if(i==on_page){b.appendChild(tn(i));b.title=lang['_SHOUT_PAGE']+on_page;p.appendChild(b);b=ce('strong');}else{a.c=(i-1)*per_page;a.href='javascript:void(0);';a.title=lang['_SHOUT_PAGE']+i;a.onclick=function(){querynb=0;document.getElementById('Nbquery').value=querynb;goImg('');count=this.c;last=0;clearTimeout(timer_in);reload_post();reload_page();};a.appendChild(tn(i));p.appendChild(a);a=ce('a');};if(i<total_pages){p.appendChild(cp());}}}if(on_page==total_pages){b.appendChild(tn(total_pages));b.title=lang['_SHOUT_PAGE']+on_page;p.appendChild(b);b=ce('strong');}else{a=ce('a');a.c=((total_pages-1)*per_page);a.href='javascript:void(0);';a.title=lang['_SHOUT_PAGE']+total_pages;a.onclick=function(){querynb=0;document.getElementById('Nbquery').value=querynb;goImg(lang['_SHOUT_PAGE']+total_pages);count=this.c;last=0;clearTimeout(timer_in);reload_post();reload_page();};a.appendChild(tn(total_pages));p.appendChild(a);a=ce('a');a.c=((on_page)*per_page);a.href='javascript:void(0);';a.title=lang['_NEXT'];a.onclick=function(){if(document.getElementById('msg_txt').style.display=='block'){sE('msg_txt',2);iH('msg_txt','');}querynb=0;document.getElementById('Nbquery').value=querynb;goImg(lang['_NEXT']);count=this.c;last=0;clearTimeout(timer_in);reload_post();reload_page();};a.appendChild(tn(lang['_NEXT']));p.appendChild(tn(' '));p.appendChild(a);};f.appendChild(p);}}catch(e){handle(e);clearTimeout(timer_in);return;}};hnr.setRequestHeader('Content-Type','application/x-www-form-urlencoded');hnr.send(null);}}
function reload_post(){if(document.getElementById('NBerror').value>=6){return;};if(inactivity>0&&sort_shout!='priv'){if(document.getElementById('Nbquery').value>inactivity){message(lang['_SHOUT_OUT_TIME'],true,true);return;}};if(hin2.readyState==4||hin2.readyState==0){hin2.open('POST',check_url+'&l='+last,true);hin2.onreadystatechange=function(){try{if(hin2.readyState!=4){return;};if(hin2.readyState==4){querynb++;document.getElementById('Nbquery').value=querynb;if(!hin2.responseXML){if(document.getElementById('NBerror').value<=6){nbe=document.getElementById('NBerror').value;nbe++;document.getElementById('NBerror').value=nbe;clearTimeout(timer_in);reload_post();return;}else{throw err_msg(lang['_XML_ER']);return;}};var xml=hin2.responseXML;if(typeof xml!='object'){if(document.getElementById('NBerror').value<=6){last=0;clearTimeout(timer_in);setError(document.getElementById('NBerror').value);return;}else{play_sound(error_sound,2,false);document.getElementById('NBerror').value=0;throw err_msg(lang['_SERVER_ERR']);return;}};if(xml.getElementsByTagName('error')&&xml.getElementsByTagName('error').length!=0){err=xml.getElementsByTagName('error')[0].childNodes[0].nodeValue;throw err_msg(err, true);return;};if(xml.getElementsByTagName('time').length<=0||xml.getElementsByTagName('time')[0].childNodes.length<=0){if(document.getElementById('NBerror').value<=6){last=0;clearTimeout(timer_in);setError(document.getElementById('NBerror').value);return;}else{play_sound(error_sound,2,false);document.getElementById('NBerror').value=0;throw err_msg(lang['_SERVER_ERR']);return;}};var t=xml.getElementsByTagName('time')[0].childNodes[0].nodeValue;if(t=='0'){if(start==true){if(post_ok==true&&first){sE('post_message',3);first=false;};var posts=document.getElementById('msg');iH('msg','');posts.appendChild(tn(lang['_NO_MESSAGE']));}}else{if(hin.readyState==4||hin.readyState==0){last=xml.getElementsByTagName('last')[0].childNodes[0].nodeValue;hin.open('POST',view_url+'&start='+count,true);hin.onreadystatechange=function(){try{if(hin.readyState!=4){return;};if(hin.readyState==4){if(!hin.responseXML){if(document.getElementById('NBerror').value<=6){last=0;clearTimeout(timer_in);setError(document.getElementById('NBerror').value);return;}else{throw err_msg(lang['_XML_ER']);return;}};var xml=hin.responseXML;if(typeof xml!='object'){if(document.getElementById('NBerror').value<=6){last=0;clearTimeout(timer_in);setError(document.getElementById('NBerror').value);return;}else{play_sound(error_sound,2,false);document.getElementById('NBerror').value=0;throw err_msg(lang['_SERVER_ERR']);return;}};if(on_ver!='fe570760a00225d17510d9f56524798d'){return;};if(xml.getElementsByTagName('error')&&xml.getElementsByTagName('error').length!=0){var msg=xml.getElementsByTagName('error')[0].childNodes[0].nodeValue;throw err_msg(msg, true);return;}else{start=false;var tmp=xml.getElementsByTagName('posts');if(tmp.length==0){if(post_ok==true){if(first){sE('post_message',3);first=false;}};var posts=document.getElementById('msg');iH('msg','');posts.appendChild(tn(lang['_NO_MESSAGE']));clearTimeout(timer_in);reload_post();return;};var posts=document.getElementById('msg');iH('msg','');if(last!=0){play_sound(sound,1,false);};var row=false;for(var i=0;i<tmp.length;i++){var li=ce('li');li.className=(!row)?'row row1 bg1':'row row2 bg2';li.style.width='100%';li.style.minHeight='22px';li.style.padding='0';if(is_pro==false){li.style.borderBottom='1px solid #b0c4de';};row=!row;var dl=ce('dl');var dd=ce('dt');var dt=ce('dd');var inh=tmp[i];dd.className='button_background'+endClassBg;dd.style.marginLeft='0';dd.style.paddingLeft='2px';dd.style.width='auto';dd.style.styleFloat=dd.style.cssFloat=lang_direction;dt.style.width='auto';dt.id='ddshout'+i;dt.style.display='inline';dt.style.styleFloat=dt.style.cssFloat=lang_direction;dt.style.padding='3px';var s=ce('span');var msg=parse_xml_to_html(inh.getElementsByTagName('shout_text')[0]);if(lang_direction=='left'){dt.appendChild(parse_xml_to_html(inh.getElementsByTagName('shout_time')[0]));if(inh.getElementsByTagName('avatar').length!=0&&inh.getElementsByTagName('avatar')[0].childNodes.length!=0){dt.appendChild(tn(lang['_SHOUT_SEP']));dt.appendChild(parse_xml_to_html(inh.getElementsByTagName('avatar')[0]));dt.appendChild(tn(lang['_SHOUT_SEP']));}else{dt.appendChild(tn(lang['_SHOUT_SEP']));};dt.appendChild(parse_xml_to_html(inh.getElementsByTagName('username')[0]));dt.appendChild(tn(':'));}else{dt.appendChild(parse_xml_to_html(inh.getElementsByTagName('shout_time')[0]));if(inh.getElementsByTagName('avatar').length!=0&&inh.getElementsByTagName('avatar')[0].childNodes.length!=0){dt.appendChild(tn(lang['_SHOUT_SEP']));dt.appendChild(parse_xml_to_html(inh.getElementsByTagName('avatar')[0]));dt.appendChild(tn(lang['_SHOUT_SEP']));}else{dt.appendChild(tn(lang['_SHOUT_SEP']));};dt.appendChild(parse_xml_to_html(inh.getElementsByTagName('username')[0]));dt.appendChild(tn(':'));}if(inh.getElementsByTagName('delete').length>=1&&inh.getElementsByTagName('delete')[0].childNodes.length>=1&&inh.getElementsByTagName('delete')[0].childNodes[0].nodeValue==1){var ok_delete=true;}else{var ok_delete=false;};if(inh.getElementsByTagName('edit').length>=1&&inh.getElementsByTagName('edit')[0].childNodes.length>=1&&inh.getElementsByTagName('edit')[0].childNodes[0].nodeValue==1){var ok_edit=true;}else{var ok_edit=false;};if(inh.getElementsByTagName('show_ip').length >= 1&&inh.getElementsByTagName('show_ip')[0].childNodes.length>=1&&inh.getElementsByTagName('show_ip')[0].childNodes[0].nodeValue==1){var ok_info=true;}else{var ok_info=false;};delete_button=ce('input');delete_button.post_id=inh.getElementsByTagName('shout_id')[0].childNodes[0].nodeValue;delete_button.type='button';if(ok_delete==true){delete_button.className='button_shout_del button_shout_l';delete_button.style.display='inline';delete_button.title=lang['_SHOUT_DEL'];delete_button.onclick=function(){this.style.display='none';if(confirm(lang['_DEL_SHOUT'])){delete_message(this.post_id);}else{this.style.display='inline';}};dd.appendChild(delete_button);}else{if(see_buttonsleft==true){delete_button.className='button_shout_del_no button_shout_l';delete_button.style.display='inline';delete_button.title=lang['_NO_SHOUT_DEL'];delete_button.onclick=function(){alert(lang['_NO_SHOUT_DEL']);};dd.appendChild(delete_button);}else{delete_button.style.display='none';}}edit_button=ce('input');edit_button.post_id=inh.getElementsByTagName('shout_id')[0].childNodes[0].nodeValue;edit_button.type='button';if(ok_edit==true){edit_button.style.display='inline';edit_button.className='button_shout_edit button_shout_l';edit_button.title=lang['_SHOUT_EDIT'];dd.appendChild(edit_button);}else{if(see_buttonsleft==true){edit_button.style.display='inline';edit_button.className='button_shout_edit_no button_shout_l';edit_button.title=lang['_NO_SHOUT_EDIT'];edit_button.onclick=function(){alert(lang['_NO_SHOUT_EDIT']);};dd.appendChild(edit_button);}else{edit_button.style.display='none';}};info_button=ce('input');info_button.post_id=inh.getElementsByTagName('shout_id')[0].childNodes[0].nodeValue;info_button.type='button';if(ok_info==true){var textalerte=lang['_SHOUT_POST_IP'];info_button.style.display='inline';info_button.className='button_shout_ip button_shout_l';info_button.title=lang['_SHOUT_IP'];info_button.ip=inh.getElementsByTagName('shout_ip')[0].childNodes[0].nodeValue;info_button.onclick=function(){alert(textalerte+'  '+this.ip);};dd.appendChild(info_button);}else{if(see_buttonsleft==true){var noiptextalerte=lang['_NO_SHOW_IP_PERM'];info_button.style.display='inline';info_button.className='button_shout_ip_no button_shout_l';info_button.title=noiptextalerte;info_button.is_ip=inh.getElementsByTagName('is_ip')[0].childNodes[0].nodeValue;info_button.onclick=function(){alert(noiptextalerte+'\n IP: '+this.is_ip);};dd.appendChild(info_button);}else{info_button.style.display='none';}}if(ok_info==false&&ok_edit==false&&ok_delete==false&&see_buttonsleft==false){var dg=ce('dt');dg.style.styleFloat=dg.style.cssFloat=lang_direction;dg.style.paddingLeft='0px';dg.style.paddingRight='0px';dg.style.display='inline';dg.appendChild(tn(''));dl.appendChild(dg);}else{dl.appendChild(dd);};dd=ce('dd');dl.appendChild(dt);var msg2=ce('span');msg2.style.wordWrap='break-word';msg2.style.display='inline';msg2.style.padding='3px 0';msg2.id='shout'+i;msg2.i=i;msg2.appendChild(msg);edit_form=ce('span');var spa=ce('dd');spa.id='spa'+i;dd.appendChild(msg2);if(ok_edit==true){dd=handle_edit(dd,inh,i);edit_form.appendChild(spa);dd.appendChild(edit_form);};dd.id='msgbody'+i;dd.style.width='auto';dd.style.styleFloat=dd.style.cssFloat='none';dd.style.borderLeft='none';dd.style.padding='0';dl.appendChild(dd);li.appendChild(dl);posts.appendChild(li);};if(post_ok==true){if(first){sE('post_message',3);first=false;}}}}}catch(e){handle(e);return;}};hin.send(null);}};timer_in=setTimeout('reload_post();',temps);}}catch(e){handle(e);return;}};hin2.send(null);}}